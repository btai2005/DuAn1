/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package view;

import java.awt.Component;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.math.BigDecimal;
import java.text.DecimalFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.regex.Matcher;
import java.util.regex.Pattern;
import javax.swing.ImageIcon;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JTable;
import javax.swing.JTextField;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableCellRenderer;
import model.HoaDonChiTietModel;
import model.HoaDonModel;
import model.SanPhamChiTiet;
import repository.BanHang;
import repository.HoaDonChiTietRepo;
import repository.HoaDonRepo;

/**
 *
 * @author ADMIN
 */
public class HoaDon extends javax.swing.JPanel {

    private BanHang qLy = new BanHang();
    DefaultTableModel defaultTableModel;
    BanHang repo = new BanHang();
    private int idNhanVien = 1;
    //hóa đơn
    private HoaDonRepo qlyhd = new HoaDonRepo();
    private HoaDonChiTietRepo qLyChiTiet = new HoaDonChiTietRepo();

    /**
     * Creates new form HoaDon
     */
    public HoaDon() {
        initComponents();
        fillTableHoaDonCho();
        fillTableSp();
        this.fillTableHoaDon();
        this.showPopup(tblHoaDon);
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPopupMenu1 = new javax.swing.JPopupMenu();
        jMenuItem3 = new javax.swing.JMenuItem();
        jMenuItem4 = new javax.swing.JMenuItem();
        jTabbedPane4 = new javax.swing.JTabbedPane();
        jPanel9 = new javax.swing.JPanel();
        jPanel8 = new javax.swing.JPanel();
        jLabel33 = new javax.swing.JLabel();
        jblMaHoaDon = new javax.swing.JLabel();
        btChonKhachHang = new javax.swing.JButton();
        btnHuyKhachHang = new javax.swing.JButton();
        jLabel34 = new javax.swing.JLabel();
        jLabel35 = new javax.swing.JLabel();
        txtTenKhachHang = new javax.swing.JTextField();
        txtSoDienThoai = new javax.swing.JTextField();
        jLabel36 = new javax.swing.JLabel();
        txtTongTien = new javax.swing.JTextField();
        jLabel37 = new javax.swing.JLabel();
        btnVoucher = new javax.swing.JButton();
        btnApDung = new javax.swing.JButton();
        btnHuyVoucher = new javax.swing.JButton();
        jLabel38 = new javax.swing.JLabel();
        txtMaVoucher = new javax.swing.JTextField();
        jLabel39 = new javax.swing.JLabel();
        txtGiamGia = new javax.swing.JTextField();
        jLabel40 = new javax.swing.JLabel();
        txtThanhTien = new javax.swing.JTextField();
        jLabel41 = new javax.swing.JLabel();
        jLabel42 = new javax.swing.JLabel();
        txtTienMat = new javax.swing.JTextField();
        jLabel45 = new javax.swing.JLabel();
        cbbThanhToan = new javax.swing.JComboBox<>();
        jLabel46 = new javax.swing.JLabel();
        jLabel47 = new javax.swing.JLabel();
        txtChuyenKhoan = new javax.swing.JTextField();
        jLabel48 = new javax.swing.JLabel();
        jLabel49 = new javax.swing.JLabel();
        txtTienDu = new javax.swing.JTextField();
        jLabel50 = new javax.swing.JLabel();
        btnHoanTien = new javax.swing.JButton();
        btnThanhToan = new javax.swing.JButton();
        btnInHoaDon = new javax.swing.JButton();
        btnTaoHoaDon = new javax.swing.JButton();
        jTabbedPane5 = new javax.swing.JTabbedPane();
        jScrollPane5 = new javax.swing.JScrollPane();
        tblHoaDon = new javax.swing.JTable();
        jLabel51 = new javax.swing.JLabel();
        jScrollPane8 = new javax.swing.JScrollPane();
        tblHoaDonCho = new javax.swing.JTable();
        jScrollPane7 = new javax.swing.JScrollPane();
        tblsanpham = new javax.swing.JTable();
        btnTimKiem = new javax.swing.JButton();
        txtSearch = new javax.swing.JTextField();
        jPanel12 = new javax.swing.JPanel();
        jPanel16 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        jSeparator1 = new javax.swing.JSeparator();
        jLabel52 = new javax.swing.JLabel();
        btnSearch = new javax.swing.JButton();
        jLabel53 = new javax.swing.JLabel();
        jLabel54 = new javax.swing.JLabel();
        jLabel55 = new javax.swing.JLabel();
        cbbTrangThai = new javax.swing.JComboBox<>();
        btnLoc = new javax.swing.JButton();
        jScrollPane9 = new javax.swing.JScrollPane();
        tblLichSuHoaDon = new javax.swing.JTable();
        txtSearchMaHoaDon = new javax.swing.JTextField();
        txtLocNgayBD = new com.toedter.calendar.JDateChooser();
        txtLocNgayKT = new com.toedter.calendar.JDateChooser();
        jPanel17 = new javax.swing.JPanel();
        jLabel56 = new javax.swing.JLabel();
        jSeparator2 = new javax.swing.JSeparator();
        jPanel18 = new javax.swing.JPanel();
        jPanel21 = new javax.swing.JPanel();
        jPanel20 = new javax.swing.JPanel();
        jLabel60 = new javax.swing.JLabel();
        jLabel61 = new javax.swing.JLabel();
        jLabel62 = new javax.swing.JLabel();
        jLabel63 = new javax.swing.JLabel();
        jLabel64 = new javax.swing.JLabel();
        lblMaHoaDon = new javax.swing.JLabel();
        lblTenKhachHang = new javax.swing.JLabel();
        lblSoDienThoai = new javax.swing.JLabel();
        lblThoiGianTao = new javax.swing.JLabel();
        lblLoaiThanhToan = new javax.swing.JLabel();
        jPanel19 = new javax.swing.JPanel();
        jLabel57 = new javax.swing.JLabel();
        lblVoucher = new javax.swing.JLabel();
        lblTrangThai = new javax.swing.JLabel();
        lbltenVoucher = new javax.swing.JLabel();
        jLabel58 = new javax.swing.JLabel();
        lblThanhTienHD = new javax.swing.JLabel();
        lblTongTienHD = new javax.swing.JLabel();
        jLabel59 = new javax.swing.JLabel();
        jScrollPane10 = new javax.swing.JScrollPane();
        tblSanPhamHD = new javax.swing.JTable();

        jPopupMenu1.setAutoscrolls(true);

        jMenuItem3.setText("Sua so luong");
        jMenuItem3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem3ActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jMenuItem3);

        jMenuItem4.setText("Hủy Chọn");
        jMenuItem4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jMenuItem4ActionPerformed(evt);
            }
        });
        jPopupMenu1.add(jMenuItem4);

        jPanel9.setBackground(new java.awt.Color(255, 255, 255));

        jLabel33.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel33.setText("Mã Hóa Đơn:");

        jblMaHoaDon.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jblMaHoaDon.setForeground(new java.awt.Color(51, 153, 255));
        jblMaHoaDon.setText("#####");

        btChonKhachHang.setBackground(new java.awt.Color(153, 0, 0));
        btChonKhachHang.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btChonKhachHang.setForeground(new java.awt.Color(255, 255, 255));
        btChonKhachHang.setText("Chọn Khách Hàng");
        btChonKhachHang.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btChonKhachHangActionPerformed(evt);
            }
        });

        btnHuyKhachHang.setBackground(new java.awt.Color(153, 0, 0));
        btnHuyKhachHang.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btnHuyKhachHang.setForeground(new java.awt.Color(255, 255, 255));
        btnHuyKhachHang.setText("Hủy");
        btnHuyKhachHang.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnHuyKhachHangActionPerformed(evt);
            }
        });

        jLabel34.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel34.setText("Tên Khách Hàng:");

        jLabel35.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel35.setText("SĐT Khách Hàng:");

        txtTenKhachHang.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N

        txtSoDienThoai.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N

        jLabel36.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel36.setText("Tổng Tiền:");

        txtTongTien.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N

        jLabel37.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel37.setText("VNĐ");

        btnVoucher.setBackground(new java.awt.Color(153, 0, 0));
        btnVoucher.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btnVoucher.setForeground(new java.awt.Color(255, 255, 255));
        btnVoucher.setText("Voucher");
        btnVoucher.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnVoucherActionPerformed(evt);
            }
        });

        btnApDung.setBackground(new java.awt.Color(153, 0, 0));
        btnApDung.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btnApDung.setForeground(new java.awt.Color(255, 255, 255));
        btnApDung.setText("Áp Dụng");
        btnApDung.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnApDungActionPerformed(evt);
            }
        });

        btnHuyVoucher.setBackground(new java.awt.Color(153, 0, 0));
        btnHuyVoucher.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btnHuyVoucher.setForeground(new java.awt.Color(255, 255, 255));
        btnHuyVoucher.setText("Hủy");
        btnHuyVoucher.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnHuyVoucherActionPerformed(evt);
            }
        });

        jLabel38.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel38.setText("Mã Voucher:");

        txtMaVoucher.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N

        jLabel39.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel39.setText("Giảm:");

        txtGiamGia.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N

        jLabel40.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel40.setText("Thành Tiền:");

        txtThanhTien.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N

        jLabel41.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel41.setText("VNĐ");

        jLabel42.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel42.setText("Loại Thanh Toán:");

        txtTienMat.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        txtTienMat.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtTienMatKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtTienMatKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtTienMatKeyTyped(evt);
            }
        });

        jLabel45.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel45.setText("VNĐ");

        cbbThanhToan.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        cbbThanhToan.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Tiền Mặt", "Chuyển Khoản", "Tiền Mặt và Chuyển Khoản" }));
        cbbThanhToan.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                cbbThanhToanMouseClicked(evt);
            }
        });
        cbbThanhToan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                cbbThanhToanActionPerformed(evt);
            }
        });

        jLabel46.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel46.setText("Tiền Mặt:");

        jLabel47.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel47.setText("Chuyển Khoản:");

        txtChuyenKhoan.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        txtChuyenKhoan.setEnabled(false);
        txtChuyenKhoan.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                txtChuyenKhoanKeyPressed(evt);
            }
            public void keyReleased(java.awt.event.KeyEvent evt) {
                txtChuyenKhoanKeyReleased(evt);
            }
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtChuyenKhoanKeyTyped(evt);
            }
        });

        jLabel48.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel48.setText("VNĐ");

        jLabel49.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel49.setText("Tiền Dư:");

        txtTienDu.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        txtTienDu.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtTienDuActionPerformed(evt);
            }
        });

        jLabel50.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel50.setText("VNĐ");

        btnHoanTien.setBackground(new java.awt.Color(153, 0, 0));
        btnHoanTien.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btnHoanTien.setForeground(new java.awt.Color(255, 255, 255));
        btnHoanTien.setText("Trả Lại");
        btnHoanTien.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnHoanTienActionPerformed(evt);
            }
        });

        btnThanhToan.setBackground(new java.awt.Color(153, 0, 0));
        btnThanhToan.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btnThanhToan.setForeground(new java.awt.Color(255, 255, 255));
        btnThanhToan.setText("Thanh Toán");
        btnThanhToan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnThanhToanActionPerformed(evt);
            }
        });

        btnInHoaDon.setBackground(new java.awt.Color(153, 0, 0));
        btnInHoaDon.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btnInHoaDon.setForeground(new java.awt.Color(255, 255, 255));
        btnInHoaDon.setText("In Hóa Đơn");
        btnInHoaDon.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnInHoaDonActionPerformed(evt);
            }
        });

        btnTaoHoaDon.setBackground(new java.awt.Color(0, 0, 0));
        btnTaoHoaDon.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btnTaoHoaDon.setForeground(new java.awt.Color(255, 255, 255));
        btnTaoHoaDon.setText("Tạo Hóa Đơn");
        btnTaoHoaDon.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTaoHoaDonActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel8Layout = new javax.swing.GroupLayout(jPanel8);
        jPanel8.setLayout(jPanel8Layout);
        jPanel8Layout.setHorizontalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addGap(18, 18, 18)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                    .addGroup(jPanel8Layout.createSequentialGroup()
                        .addComponent(jLabel49)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(txtTienDu, javax.swing.GroupLayout.PREFERRED_SIZE, 153, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel50)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addComponent(btnHoanTien))
                    .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(jPanel8Layout.createSequentialGroup()
                            .addComponent(btnThanhToan)
                            .addGap(18, 18, 18)
                            .addComponent(btnInHoaDon))
                        .addComponent(jLabel46)
                        .addGroup(jPanel8Layout.createSequentialGroup()
                            .addComponent(btnVoucher)
                            .addGap(18, 18, 18)
                            .addComponent(btnApDung)
                            .addGap(18, 18, 18)
                            .addComponent(btnHuyVoucher))
                        .addComponent(jLabel36)
                        .addGroup(jPanel8Layout.createSequentialGroup()
                            .addComponent(btChonKhachHang)
                            .addGap(18, 18, 18)
                            .addComponent(btnHuyKhachHang))
                        .addGroup(jPanel8Layout.createSequentialGroup()
                            .addComponent(txtChuyenKhoan, javax.swing.GroupLayout.PREFERRED_SIZE, 327, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                            .addComponent(jLabel48))
                        .addComponent(jLabel47)
                        .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addGroup(jPanel8Layout.createSequentialGroup()
                                .addComponent(txtTienMat)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jLabel45))
                            .addGroup(jPanel8Layout.createSequentialGroup()
                                .addComponent(jLabel42)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(cbbThanhToan, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                            .addGroup(jPanel8Layout.createSequentialGroup()
                                .addComponent(txtThanhTien)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jLabel41))
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel8Layout.createSequentialGroup()
                                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                    .addComponent(jLabel40, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(jLabel38, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txtMaVoucher, javax.swing.GroupLayout.PREFERRED_SIZE, 119, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(jLabel39)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(txtGiamGia))
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel8Layout.createSequentialGroup()
                                .addComponent(txtTongTien)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(jLabel37))
                            .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jPanel8Layout.createSequentialGroup()
                                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                    .addComponent(jLabel34, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                    .addComponent(jLabel35, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                                .addGap(12, 12, 12)
                                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(txtTenKhachHang, javax.swing.GroupLayout.PREFERRED_SIZE, 238, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(txtSoDienThoai, javax.swing.GroupLayout.PREFERRED_SIZE, 238, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(jPanel8Layout.createSequentialGroup()
                                .addComponent(jLabel33)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jblMaHoaDon)
                                .addGap(68, 68, 68)
                                .addComponent(btnTaoHoaDon)))))
                .addGap(12, 12, 12))
        );
        jPanel8Layout.setVerticalGroup(
            jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel8Layout.createSequentialGroup()
                .addGap(18, 18, 18)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel33)
                    .addComponent(jblMaHoaDon)
                    .addComponent(btnTaoHoaDon))
                .addGap(12, 12, 12)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btChonKhachHang)
                    .addComponent(btnHuyKhachHang))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel34)
                    .addComponent(txtTenKhachHang, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel35)
                    .addComponent(txtSoDienThoai, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jLabel36)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtTongTien, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel37))
                .addGap(12, 12, 12)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnVoucher)
                    .addComponent(btnApDung)
                    .addComponent(btnHuyVoucher))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel38)
                    .addComponent(txtMaVoucher, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel39)
                    .addComponent(txtGiamGia, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel40)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtThanhTien, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel41))
                .addGap(6, 6, 6)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel42)
                    .addComponent(cbbThanhToan, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(6, 6, 6)
                .addComponent(jLabel46)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtTienMat, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel45))
                .addGap(6, 6, 6)
                .addComponent(jLabel47)
                .addGap(6, 6, 6)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtChuyenKhoan, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel48))
                .addGap(3, 3, 3)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel49)
                    .addComponent(txtTienDu, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel50)
                    .addComponent(btnHoanTien))
                .addGap(12, 12, 12)
                .addGroup(jPanel8Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnThanhToan)
                    .addComponent(btnInHoaDon))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jTabbedPane5.setToolTipText("");
        jTabbedPane5.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N

        tblHoaDon.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        tblHoaDon.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Mã Giày", "Tên Giày", "Giá", "Số Lượng", "Tổng Tiền"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tblHoaDon.setRowHeight(25);
        tblHoaDon.setSelectionBackground(new java.awt.Color(0, 153, 153));
        tblHoaDon.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblHoaDonMouseClicked(evt);
            }
            public void mousePressed(java.awt.event.MouseEvent evt) {
                tblHoaDonMousePressed(evt);
            }
        });
        jScrollPane5.setViewportView(tblHoaDon);

        jTabbedPane5.addTab("tab1", jScrollPane5);

        jLabel51.setFont(new java.awt.Font("sansserif", 1, 14)); // NOI18N
        jLabel51.setText("Hóa Đơn Chờ");

        tblHoaDonCho.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        tblHoaDonCho.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Mã Hóa Đơn", "Tên Nhân Viên", "Tên Khách Hàng", "Thời Gian Tạo", "Trạng Thái"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tblHoaDonCho.setRowHeight(25);
        tblHoaDonCho.setSelectionBackground(new java.awt.Color(0, 153, 153));
        tblHoaDonCho.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblHoaDonChoMouseClicked(evt);
            }
        });
        jScrollPane8.setViewportView(tblHoaDonCho);

        tblsanpham.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null}
            },
            new String [] {
                "Ảnh", "Tên Giày", "Giá", "Số Lượng", "Kích cỡ", "Màu sắc"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, true, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tblsanpham.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblsanphamMouseClicked(evt);
            }
        });
        jScrollPane7.setViewportView(tblsanpham);
        if (tblsanpham.getColumnModel().getColumnCount() > 0) {
            tblsanpham.getColumnModel().getColumn(0).setPreferredWidth(50);
        }

        btnTimKiem.setBackground(new java.awt.Color(153, 0, 0));
        btnTimKiem.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btnTimKiem.setForeground(new java.awt.Color(255, 255, 255));
        btnTimKiem.setText("Tìm Kiếm");
        btnTimKiem.setPreferredSize(new java.awt.Dimension(86, 30));
        btnTimKiem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnTimKiemActionPerformed(evt);
            }
        });

        txtSearch.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        txtSearch.setActionCommand("<Not Set>");
        txtSearch.setMinimumSize(new java.awt.Dimension(64, 30));
        txtSearch.setPreferredSize(new java.awt.Dimension(64, 30));

        javax.swing.GroupLayout jPanel9Layout = new javax.swing.GroupLayout(jPanel9);
        jPanel9.setLayout(jPanel9Layout);
        jPanel9Layout.setHorizontalGroup(
            jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel9Layout.createSequentialGroup()
                .addGap(420, 420, 420)
                .addGroup(jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel9Layout.createSequentialGroup()
                        .addComponent(jLabel51)
                        .addContainerGap(625, Short.MAX_VALUE))
                    .addGroup(jPanel9Layout.createSequentialGroup()
                        .addGroup(jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(jScrollPane8, javax.swing.GroupLayout.DEFAULT_SIZE, 690, Short.MAX_VALUE)
                            .addComponent(jTabbedPane5)
                            .addGroup(jPanel9Layout.createSequentialGroup()
                                .addComponent(txtSearch, javax.swing.GroupLayout.PREFERRED_SIZE, 256, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(btnTimKiem, javax.swing.GroupLayout.PREFERRED_SIZE, 98, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(jScrollPane7))
                        .addGap(0, 0, Short.MAX_VALUE))))
            .addGroup(jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel9Layout.createSequentialGroup()
                    .addContainerGap()
                    .addComponent(jPanel8, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(737, Short.MAX_VALUE)))
        );
        jPanel9Layout.setVerticalGroup(
            jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel9Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jTabbedPane5, javax.swing.GroupLayout.DEFAULT_SIZE, 139, Short.MAX_VALUE)
                .addGap(18, 18, 18)
                .addComponent(jLabel51)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane8, javax.swing.GroupLayout.PREFERRED_SIZE, 113, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addGroup(jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtSearch, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(btnTimKiem, javax.swing.GroupLayout.PREFERRED_SIZE, 29, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jScrollPane7, javax.swing.GroupLayout.PREFERRED_SIZE, 298, javax.swing.GroupLayout.PREFERRED_SIZE))
            .addGroup(jPanel9Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(jPanel9Layout.createSequentialGroup()
                    .addContainerGap()
                    .addComponent(jPanel8, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addContainerGap(83, Short.MAX_VALUE)))
        );

        jTabbedPane4.addTab("Bán Hàng", jPanel9);

        jPanel12.setBackground(new java.awt.Color(255, 255, 255));

        jLabel2.setFont(new java.awt.Font("Segoe UI", 1, 20)); // NOI18N
        jLabel2.setText("Lịch Sử Hóa Đơn");

        jSeparator1.setBackground(new java.awt.Color(0, 153, 153));
        jSeparator1.setForeground(new java.awt.Color(0, 153, 153));

        jLabel52.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel52.setText("Mã Hóa Đơn:");

        btnSearch.setBackground(new java.awt.Color(0, 204, 255));
        btnSearch.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btnSearch.setForeground(new java.awt.Color(255, 255, 255));
        btnSearch.setText("Tìm kiếm");
        btnSearch.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSearchActionPerformed(evt);
            }
        });

        jLabel53.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel53.setText("Từ Ngày:");

        jLabel54.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel54.setText("Đến Ngày:");

        jLabel55.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        jLabel55.setText("Trạng Thái:");

        cbbTrangThai.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        cbbTrangThai.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Tất Cả", "Đã Thanh Toán", "Chưa Thanh Toán" }));

        btnLoc.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        btnLoc.setText("Lọc");
        btnLoc.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLocActionPerformed(evt);
            }
        });

        tblLichSuHoaDon.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        tblLichSuHoaDon.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null},
                {null, null, null, null, null, null}
            },
            new String [] {
                "Mã Hóa Đơn", "Người Tạo", "Khách Hàng", "Thời Gian Tạo", "Thành Tiền", "Trạng Thái"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tblLichSuHoaDon.setRowHeight(28);
        tblLichSuHoaDon.setSelectionBackground(new java.awt.Color(0, 153, 153));
        tblLichSuHoaDon.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblLichSuHoaDonMouseClicked(evt);
            }
        });
        jScrollPane9.setViewportView(tblLichSuHoaDon);

        txtSearchMaHoaDon.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        txtSearchMaHoaDon.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                txtSearchMaHoaDonActionPerformed(evt);
            }
        });

        txtLocNgayBD.setDateFormatString("yyyy-MM-dd");
        txtLocNgayBD.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N

        txtLocNgayKT.setDateFormatString("yyyy-MM-dd");
        txtLocNgayKT.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N

        javax.swing.GroupLayout jPanel16Layout = new javax.swing.GroupLayout(jPanel16);
        jPanel16.setLayout(jPanel16Layout);
        jPanel16Layout.setHorizontalGroup(
            jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel16Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jScrollPane9, javax.swing.GroupLayout.PREFERRED_SIZE, 789, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(792, 792, 792))
            .addGroup(jPanel16Layout.createSequentialGroup()
                .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel16Layout.createSequentialGroup()
                        .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel16Layout.createSequentialGroup()
                                .addGap(42, 42, 42)
                                .addComponent(jLabel52))
                            .addGroup(jPanel16Layout.createSequentialGroup()
                                .addContainerGap()
                                .addComponent(txtSearchMaHoaDon, javax.swing.GroupLayout.PREFERRED_SIZE, 192, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(btnSearch, javax.swing.GroupLayout.PREFERRED_SIZE, 93, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(36, 36, 36)
                        .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txtLocNgayBD, javax.swing.GroupLayout.PREFERRED_SIZE, 175, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel53))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(txtLocNgayKT, javax.swing.GroupLayout.PREFERRED_SIZE, 175, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel54))
                        .addGap(18, 18, 18)
                        .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel55)
                            .addGroup(jPanel16Layout.createSequentialGroup()
                                .addComponent(cbbTrangThai, javax.swing.GroupLayout.PREFERRED_SIZE, 160, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(btnLoc, javax.swing.GroupLayout.PREFERRED_SIZE, 88, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(jPanel16Layout.createSequentialGroup()
                        .addGap(200, 200, 200)
                        .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 1011, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel16Layout.createSequentialGroup()
                        .addGap(407, 407, 407)
                        .addComponent(jLabel2)))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel16Layout.setVerticalGroup(
            jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel16Layout.createSequentialGroup()
                .addGap(14, 14, 14)
                .addComponent(jLabel2)
                .addGap(18, 18, 18)
                .addComponent(jSeparator1, javax.swing.GroupLayout.PREFERRED_SIZE, 3, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel16Layout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jLabel52)
                            .addComponent(jLabel53))
                        .addGap(6, 6, 6)
                        .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(btnSearch, javax.swing.GroupLayout.PREFERRED_SIZE, 27, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(txtSearchMaHoaDon, javax.swing.GroupLayout.PREFERRED_SIZE, 27, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addGap(18, 18, 18))
                    .addGroup(jPanel16Layout.createSequentialGroup()
                        .addGap(18, 18, 18)
                        .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(jPanel16Layout.createSequentialGroup()
                                .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel54, javax.swing.GroupLayout.Alignment.TRAILING)
                                    .addComponent(jLabel55, javax.swing.GroupLayout.Alignment.TRAILING))
                                .addGap(6, 6, 6)
                                .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(txtLocNgayBD, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 27, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addComponent(txtLocNgayKT, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.PREFERRED_SIZE, 27, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(jPanel16Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                .addComponent(cbbTrangThai, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(btnLoc)))
                        .addGap(17, 17, 17)))
                .addComponent(jScrollPane9, javax.swing.GroupLayout.PREFERRED_SIZE, 176, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        jPanel17.setBackground(new java.awt.Color(153, 153, 153));

        jLabel56.setFont(new java.awt.Font("Segoe UI", 1, 20)); // NOI18N
        jLabel56.setText("Chi Tiết Hóa Đơn");

        jSeparator2.setBackground(new java.awt.Color(0, 153, 153));
        jSeparator2.setForeground(new java.awt.Color(0, 153, 153));

        jPanel18.setBackground(new java.awt.Color(153, 153, 153));

        javax.swing.GroupLayout jPanel18Layout = new javax.swing.GroupLayout(jPanel18);
        jPanel18.setLayout(jPanel18Layout);
        jPanel18Layout.setHorizontalGroup(
            jPanel18Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 36, Short.MAX_VALUE)
        );
        jPanel18Layout.setVerticalGroup(
            jPanel18Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 334, Short.MAX_VALUE)
        );

        javax.swing.GroupLayout jPanel21Layout = new javax.swing.GroupLayout(jPanel21);
        jPanel21.setLayout(jPanel21Layout);
        jPanel21Layout.setHorizontalGroup(
            jPanel21Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 669, Short.MAX_VALUE)
        );
        jPanel21Layout.setVerticalGroup(
            jPanel21Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 307, Short.MAX_VALUE)
        );

        jPanel20.setBackground(new java.awt.Color(153, 153, 153));

        jLabel60.setFont(new java.awt.Font("Segoe UI", 1, 12)); // NOI18N
        jLabel60.setText("Mã Hóa Đơn:");

        jLabel61.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        jLabel61.setText("Khách Hàng:");

        jLabel62.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        jLabel62.setText("Số Điện Thoại:");

        jLabel63.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        jLabel63.setText("Thời Gian Tạo:");

        jLabel64.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        jLabel64.setText("Loại Thanh Toán:");

        lblMaHoaDon.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        lblMaHoaDon.setText("X");

        lblTenKhachHang.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        lblTenKhachHang.setText("X");

        lblSoDienThoai.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        lblSoDienThoai.setText("X");

        lblThoiGianTao.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        lblThoiGianTao.setText("X");

        lblLoaiThanhToan.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        lblLoaiThanhToan.setText("X");

        javax.swing.GroupLayout jPanel20Layout = new javax.swing.GroupLayout(jPanel20);
        jPanel20.setLayout(jPanel20Layout);
        jPanel20Layout.setHorizontalGroup(
            jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel20Layout.createSequentialGroup()
                .addGap(0, 0, 0)
                .addGroup(jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addGroup(jPanel20Layout.createSequentialGroup()
                        .addComponent(jLabel64)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lblLoaiThanhToan, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(jPanel20Layout.createSequentialGroup()
                        .addGroup(jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                            .addComponent(jLabel63, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                            .addComponent(jLabel62, javax.swing.GroupLayout.Alignment.LEADING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addGap(23, 23, 23)
                        .addGroup(jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblThoiGianTao, javax.swing.GroupLayout.PREFERRED_SIZE, 130, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(lblSoDienThoai, javax.swing.GroupLayout.PREFERRED_SIZE, 112, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGroup(jPanel20Layout.createSequentialGroup()
                        .addGroup(jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel61, javax.swing.GroupLayout.PREFERRED_SIZE, 96, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel60))
                        .addGap(18, 18, 18)
                        .addGroup(jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                            .addComponent(lblTenKhachHang, javax.swing.GroupLayout.DEFAULT_SIZE, 117, Short.MAX_VALUE)
                            .addComponent(lblMaHoaDon, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );
        jPanel20Layout.setVerticalGroup(
            jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel20Layout.createSequentialGroup()
                .addGap(30, 30, 30)
                .addGroup(jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel60)
                    .addComponent(lblMaHoaDon))
                .addGap(25, 25, 25)
                .addGroup(jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel61)
                    .addComponent(lblTenKhachHang))
                .addGap(25, 25, 25)
                .addGroup(jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel62)
                    .addComponent(lblSoDienThoai))
                .addGap(25, 25, 25)
                .addGroup(jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel63)
                    .addComponent(lblThoiGianTao))
                .addGap(25, 25, 25)
                .addGroup(jPanel20Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel64)
                    .addComponent(lblLoaiThanhToan))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jPanel19.setBackground(new java.awt.Color(153, 153, 153));

        jLabel57.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        jLabel57.setText("Trạng Thái:");

        lblVoucher.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        lblVoucher.setText("Voucher Giảm:");

        lblTrangThai.setFont(new java.awt.Font("Segoe UI", 1, 14)); // NOI18N
        lblTrangThai.setForeground(new java.awt.Color(0, 153, 153));
        lblTrangThai.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        lblTrangThai.setText("X");

        lbltenVoucher.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        lbltenVoucher.setText("X");

        jLabel58.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        jLabel58.setText("Thành Tiền Hóa Đơn:");

        lblThanhTienHD.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        lblThanhTienHD.setText("X");

        lblTongTienHD.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        lblTongTienHD.setText("X");

        jLabel59.setFont(new java.awt.Font("Segoe UI", 1, 13)); // NOI18N
        jLabel59.setText("Tổng Tiền Hóa Đơn:");

        javax.swing.GroupLayout jPanel19Layout = new javax.swing.GroupLayout(jPanel19);
        jPanel19.setLayout(jPanel19Layout);
        jPanel19Layout.setHorizontalGroup(
            jPanel19Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel19Layout.createSequentialGroup()
                .addGap(89, 89, 89)
                .addComponent(jLabel57)
                .addGap(0, 0, Short.MAX_VALUE))
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel19Layout.createSequentialGroup()
                .addContainerGap(88, Short.MAX_VALUE)
                .addGroup(jPanel19Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel19Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(jLabel59, javax.swing.GroupLayout.PREFERRED_SIZE, 141, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(lblTrangThai, javax.swing.GroupLayout.PREFERRED_SIZE, 152, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel19Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(lblVoucher)
                        .addComponent(lblTongTienHD, javax.swing.GroupLayout.PREFERRED_SIZE, 151, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel19Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addComponent(lblThanhTienHD, javax.swing.GroupLayout.PREFERRED_SIZE, 117, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabel58)
                        .addComponent(lbltenVoucher, javax.swing.GroupLayout.PREFERRED_SIZE, 151, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap())
        );
        jPanel19Layout.setVerticalGroup(
            jPanel19Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel19Layout.createSequentialGroup()
                .addGap(28, 28, 28)
                .addComponent(jLabel57)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lblTrangThai)
                .addGap(18, 18, 18)
                .addComponent(jLabel59)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lblTongTienHD)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lblVoucher)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(lbltenVoucher)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jLabel58)
                .addGap(5, 5, 5)
                .addComponent(lblThanhTienHD)
                .addContainerGap())
        );

        tblSanPhamHD.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Mã Giày", "Tên Giày", "Đơn Giá", "Số Lượng", "Thành Tiền"
            }
        ) {
            boolean[] canEdit = new boolean [] {
                false, false, false, false, false
            };

            public boolean isCellEditable(int rowIndex, int columnIndex) {
                return canEdit [columnIndex];
            }
        });
        tblSanPhamHD.setRowHeight(30);
        tblSanPhamHD.setSelectionBackground(new java.awt.Color(0, 153, 153));
        jScrollPane10.setViewportView(tblSanPhamHD);

        javax.swing.GroupLayout jPanel17Layout = new javax.swing.GroupLayout(jPanel17);
        jPanel17.setLayout(jPanel17Layout);
        jPanel17Layout.setHorizontalGroup(
            jPanel17Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel17Layout.createSequentialGroup()
                .addGap(5, 5, 5)
                .addComponent(jPanel20, javax.swing.GroupLayout.PREFERRED_SIZE, 221, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(5, 5, 5)
                .addComponent(jPanel19, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jScrollPane10, javax.swing.GroupLayout.PREFERRED_SIZE, 618, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jPanel18, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGroup(jPanel17Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel17Layout.createSequentialGroup()
                        .addGap(97, 97, 97)
                        .addGroup(jPanel17Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jPanel17Layout.createSequentialGroup()
                                .addGap(64, 64, 64)
                                .addComponent(jLabel56))
                            .addComponent(jSeparator2, javax.swing.GroupLayout.PREFERRED_SIZE, 1019, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                    .addGroup(jPanel17Layout.createSequentialGroup()
                        .addGap(766, 766, 766)
                        .addComponent(jPanel21, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE))))
        );
        jPanel17Layout.setVerticalGroup(
            jPanel17Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel17Layout.createSequentialGroup()
                .addGroup(jPanel17Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel17Layout.createSequentialGroup()
                        .addGap(20, 20, 20)
                        .addComponent(jLabel56)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jSeparator2, javax.swing.GroupLayout.PREFERRED_SIZE, 1, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(43, 43, 43)
                        .addComponent(jPanel21, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jPanel20, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(jPanel17Layout.createSequentialGroup()
                        .addContainerGap()
                        .addGroup(jPanel17Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jPanel19, javax.swing.GroupLayout.PREFERRED_SIZE, 236, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jPanel18, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane10, javax.swing.GroupLayout.PREFERRED_SIZE, 267, javax.swing.GroupLayout.PREFERRED_SIZE))))
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout jPanel12Layout = new javax.swing.GroupLayout(jPanel12);
        jPanel12.setLayout(jPanel12Layout);
        jPanel12Layout.setHorizontalGroup(
            jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel12Layout.createSequentialGroup()
                .addGroup(jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jPanel12Layout.createSequentialGroup()
                        .addGap(40, 40, 40)
                        .addComponent(jPanel16, javax.swing.GroupLayout.PREFERRED_SIZE, 1008, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel12Layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jPanel17, javax.swing.GroupLayout.PREFERRED_SIZE, 1116, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(15, Short.MAX_VALUE))
        );
        jPanel12Layout.setVerticalGroup(
            jPanel12Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel12Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jPanel16, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(jPanel17, javax.swing.GroupLayout.PREFERRED_SIZE, 290, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        jTabbedPane4.addTab("Hóa Đơn", jPanel12);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 1149, Short.MAX_VALUE)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addContainerGap()
                    .addComponent(jTabbedPane4)
                    .addContainerGap()))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGap(0, 700, Short.MAX_VALUE)
            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                .addGroup(layout.createSequentialGroup()
                    .addContainerGap()
                    .addComponent(jTabbedPane4)
                    .addContainerGap()))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void btChonKhachHangActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btChonKhachHangActionPerformed

                this.frameKhachHang("Khách Hàng");
    }//GEN-LAST:event_btChonKhachHangActionPerformed

    private void btnHuyKhachHangActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnHuyKhachHangActionPerformed

        this.huyKhachHang();
    }//GEN-LAST:event_btnHuyKhachHangActionPerformed

    private void btnVoucherActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnVoucherActionPerformed

                this.frameVoucher("Voucher");
    }//GEN-LAST:event_btnVoucherActionPerformed

    private void btnApDungActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnApDungActionPerformed

                this.inputThanhTien(true);
    }//GEN-LAST:event_btnApDungActionPerformed

    private void btnHuyVoucherActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnHuyVoucherActionPerformed

        //        this.huyVoucher();
    }//GEN-LAST:event_btnHuyVoucherActionPerformed

    private void txtTienMatKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtTienMatKeyPressed

        this.tienMat();
    }//GEN-LAST:event_txtTienMatKeyPressed

    private void txtTienMatKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtTienMatKeyReleased

        tienMat();
    }//GEN-LAST:event_txtTienMatKeyReleased

    private void txtTienMatKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtTienMatKeyTyped

        this.tienMat();
    }//GEN-LAST:event_txtTienMatKeyTyped

    private void cbbThanhToanMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_cbbThanhToanMouseClicked

    }//GEN-LAST:event_cbbThanhToanMouseClicked

    private void cbbThanhToanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_cbbThanhToanActionPerformed

        this.updateCbbThanhToan();
    }//GEN-LAST:event_cbbThanhToanActionPerformed

    private void txtChuyenKhoanKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtChuyenKhoanKeyPressed

        this.chuyenKhoan();
    }//GEN-LAST:event_txtChuyenKhoanKeyPressed

    private void txtChuyenKhoanKeyReleased(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtChuyenKhoanKeyReleased

        chuyenKhoan();
    }//GEN-LAST:event_txtChuyenKhoanKeyReleased

    private void txtChuyenKhoanKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtChuyenKhoanKeyTyped

        this.chuyenKhoan();
    }//GEN-LAST:event_txtChuyenKhoanKeyTyped

    private void btnHoanTienActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnHoanTienActionPerformed

        if (jblMaHoaDon.getText().equals("#####")) {
            JOptionPane.showMessageDialog(this, "Chọn hóa đơn cần trả lại tiền dư");
        } else {

            if (txtTienMat.getText().trim().isEmpty() && txtChuyenKhoan.getText().trim().isEmpty()) {
                JOptionPane.showMessageDialog(this, "Khách hàng chưa thanh toán hóa đơn");
            } else {
                if ((txtTienDu.getText().trim().isEmpty() || Long.parseLong(txtTienDu.getText()) == 0)) {
                    JOptionPane.showMessageDialog(this, "Khách hàng thanh toán đủ");
                } else if (Long.parseLong(txtTienDu.getText()) < 0) {
                    JOptionPane.showMessageDialog(this, "Khách hàng thanh toán thiếu");
                } else {

                    String thanhTien = txtThanhTien.getText().replace(".", "");

                    if (!txtTienMat.getText().trim().isEmpty() && !txtChuyenKhoan.getText().trim().isEmpty()) {

                        if (Long.parseLong(txtTienMat.getText()) == Long.parseLong(thanhTien)) {

                            txtChuyenKhoan.setText(null);
                        } else if (Long.parseLong(txtTienMat.getText()) > Long.parseLong(thanhTien)) {

                            txtTienMat.setText(thanhTien);
                            txtChuyenKhoan.setText(null);
                        } else if (Long.parseLong(txtChuyenKhoan.getText()) > Long.parseLong(thanhTien)) {

                            txtTienMat.setText(null);
                            txtChuyenKhoan.setText(thanhTien);
                        } else if (Long.parseLong(txtChuyenKhoan.getText()) == Long.parseLong(thanhTien)) {

                            txtTienMat.setText(null);
                        } else if (Long.parseLong(txtChuyenKhoan.getText()) == Long.parseLong(txtTienDu.getText())) {

                            txtChuyenKhoan.setText(null);
                        } else if (Long.parseLong(txtChuyenKhoan.getText()) > Long.parseLong(txtTienDu.getText())) {

                            long tienTra = Long.parseLong(txtChuyenKhoan.getText()) - Long.parseLong(txtTienDu.getText());
                            txtChuyenKhoan.setText(String.valueOf(tienTra));
                        } else if (Long.parseLong(txtTienMat.getText()) == Long.parseLong(txtTienDu.getText())) {

                            txtTienMat.setText(null);
                        } else if (Long.parseLong(txtTienMat.getText()) > Long.parseLong(txtTienDu.getText())) {

                            long tienTra = Long.parseLong(txtTienMat.getText()) - Long.parseLong(txtTienDu.getText());
                            txtTienMat.setText(String.valueOf(tienTra));
                        } else {

                            long tienTra = Long.parseLong(txtTienMat.getText()) + Long.parseLong(txtChuyenKhoan.getText()) - Long.parseLong(txtTienDu.getText());
                            txtTienMat.setText(String.valueOf(tienTra));
                        }
                    } else if (!txtTienMat.getText().trim().isEmpty()) {

                        txtTienMat.setText(thanhTien);
                    } else if (!txtChuyenKhoan.getText().trim().isEmpty()) {

                        txtChuyenKhoan.setText(thanhTien);
                    }
                    txtTienDu.setText("0");
                    JOptionPane.showMessageDialog(this, "Đã trả lại tiền dư cho khách hàng");
                }
            }
        }

    }//GEN-LAST:event_btnHoanTienActionPerformed

    private void btnThanhToanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnThanhToanActionPerformed

        this.thanhToan();
    }//GEN-LAST:event_btnThanhToanActionPerformed

    private void btnInHoaDonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnInHoaDonActionPerformed

        //        this.inHoaDon(jblMaHoaDon.getText(), true);
    }//GEN-LAST:event_btnInHoaDonActionPerformed

    private void btnTaoHoaDonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTaoHoaDonActionPerformed

        this.createHoaDon();
    }//GEN-LAST:event_btnTaoHoaDonActionPerformed

    private void tblHoaDonChoMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblHoaDonChoMouseClicked

        showData(tblHoaDon.getSelectedRow());
    }//GEN-LAST:event_tblHoaDonChoMouseClicked

    private void btnTimKiemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnTimKiemActionPerformed

        fillTableSp();
    }//GEN-LAST:event_btnTimKiemActionPerformed

    private void btnSearchActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSearchActionPerformed

        this.fillTableHoaDon();
    }//GEN-LAST:event_btnSearchActionPerformed

    private void btnLocActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLocActionPerformed
        this.fillTableHoaDon();
    }//GEN-LAST:event_btnLocActionPerformed

    private void tblLichSuHoaDonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblLichSuHoaDonMouseClicked

        this.fillDataHoaDon(getLichSuHoaDon(tblLichSuHoaDon.getSelectedRow()));
        this.fillTableHoaDonCT(getLichSuHoaDon(tblLichSuHoaDon.getSelectedRow()).getId());
    }//GEN-LAST:event_tblLichSuHoaDonMouseClicked

    private void txtTienDuActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtTienDuActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtTienDuActionPerformed

    private void tblsanphamMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblsanphamMouseClicked

        this.chonSanPham();
    }//GEN-LAST:event_tblsanphamMouseClicked

    private void txtSearchMaHoaDonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_txtSearchMaHoaDonActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_txtSearchMaHoaDonActionPerformed

    private void tblHoaDonMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblHoaDonMouseClicked
        // TODO add your handling code here:
        
    }//GEN-LAST:event_tblHoaDonMouseClicked

    private void tblHoaDonMousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblHoaDonMousePressed
        
    }//GEN-LAST:event_tblHoaDonMousePressed

    private void jMenuItem3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem3ActionPerformed
        this.updateSoLuong();
    }//GEN-LAST:event_jMenuItem3ActionPerformed

    private void jMenuItem4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jMenuItem4ActionPerformed
        // TODO add your handling code here:
        this.updateTrangThai();
    }//GEN-LAST:event_jMenuItem4ActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btChonKhachHang;
    private javax.swing.JButton btnApDung;
    private javax.swing.JButton btnHoanTien;
    private javax.swing.JButton btnHuyKhachHang;
    private javax.swing.JButton btnHuyVoucher;
    private javax.swing.JButton btnInHoaDon;
    private javax.swing.JButton btnLoc;
    private javax.swing.JButton btnSearch;
    private javax.swing.JButton btnTaoHoaDon;
    private javax.swing.JButton btnThanhToan;
    private javax.swing.JButton btnTimKiem;
    private javax.swing.JButton btnVoucher;
    private javax.swing.JComboBox<String> cbbThanhToan;
    private javax.swing.JComboBox<String> cbbTrangThai;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel33;
    private javax.swing.JLabel jLabel34;
    private javax.swing.JLabel jLabel35;
    private javax.swing.JLabel jLabel36;
    private javax.swing.JLabel jLabel37;
    private javax.swing.JLabel jLabel38;
    private javax.swing.JLabel jLabel39;
    private javax.swing.JLabel jLabel40;
    private javax.swing.JLabel jLabel41;
    private javax.swing.JLabel jLabel42;
    private javax.swing.JLabel jLabel45;
    private javax.swing.JLabel jLabel46;
    private javax.swing.JLabel jLabel47;
    private javax.swing.JLabel jLabel48;
    private javax.swing.JLabel jLabel49;
    private javax.swing.JLabel jLabel50;
    private javax.swing.JLabel jLabel51;
    private javax.swing.JLabel jLabel52;
    private javax.swing.JLabel jLabel53;
    private javax.swing.JLabel jLabel54;
    private javax.swing.JLabel jLabel55;
    private javax.swing.JLabel jLabel56;
    private javax.swing.JLabel jLabel57;
    private javax.swing.JLabel jLabel58;
    private javax.swing.JLabel jLabel59;
    private javax.swing.JLabel jLabel60;
    private javax.swing.JLabel jLabel61;
    private javax.swing.JLabel jLabel62;
    private javax.swing.JLabel jLabel63;
    private javax.swing.JLabel jLabel64;
    private javax.swing.JMenuItem jMenuItem3;
    private javax.swing.JMenuItem jMenuItem4;
    private javax.swing.JPanel jPanel12;
    private javax.swing.JPanel jPanel16;
    private javax.swing.JPanel jPanel17;
    private javax.swing.JPanel jPanel18;
    private javax.swing.JPanel jPanel19;
    private javax.swing.JPanel jPanel20;
    private javax.swing.JPanel jPanel21;
    private javax.swing.JPanel jPanel8;
    private javax.swing.JPanel jPanel9;
    private javax.swing.JPopupMenu jPopupMenu1;
    private javax.swing.JScrollPane jScrollPane10;
    private javax.swing.JScrollPane jScrollPane5;
    private javax.swing.JScrollPane jScrollPane7;
    private javax.swing.JScrollPane jScrollPane8;
    private javax.swing.JScrollPane jScrollPane9;
    private javax.swing.JSeparator jSeparator1;
    private javax.swing.JSeparator jSeparator2;
    private javax.swing.JTabbedPane jTabbedPane4;
    private javax.swing.JTabbedPane jTabbedPane5;
    private javax.swing.JLabel jblMaHoaDon;
    private javax.swing.JLabel lblLoaiThanhToan;
    private javax.swing.JLabel lblMaHoaDon;
    private javax.swing.JLabel lblSoDienThoai;
    private javax.swing.JLabel lblTenKhachHang;
    private javax.swing.JLabel lblThanhTienHD;
    private javax.swing.JLabel lblThoiGianTao;
    private javax.swing.JLabel lblTongTienHD;
    private javax.swing.JLabel lblTrangThai;
    private javax.swing.JLabel lblVoucher;
    private javax.swing.JLabel lbltenVoucher;
    private javax.swing.JTable tblHoaDon;
    private javax.swing.JTable tblHoaDonCho;
    private javax.swing.JTable tblLichSuHoaDon;
    private javax.swing.JTable tblSanPhamHD;
    private javax.swing.JTable tblsanpham;
    private javax.swing.JTextField txtChuyenKhoan;
    private javax.swing.JTextField txtGiamGia;
    private com.toedter.calendar.JDateChooser txtLocNgayBD;
    private com.toedter.calendar.JDateChooser txtLocNgayKT;
    private javax.swing.JTextField txtMaVoucher;
    private javax.swing.JTextField txtSearch;
    private javax.swing.JTextField txtSearchMaHoaDon;
    private javax.swing.JTextField txtSoDienThoai;
    private javax.swing.JTextField txtTenKhachHang;
    private javax.swing.JTextField txtThanhTien;
    private javax.swing.JTextField txtTienDu;
    private javax.swing.JTextField txtTienMat;
    private javax.swing.JTextField txtTongTien;
    // End of variables declaration//GEN-END:variables

    public void fillTableHoaDonCho() {
        DefaultTableModel tblModel = (DefaultTableModel) tblHoaDonCho.getModel();
        tblModel.setRowCount(0);

        for (HoaDonModel x : repo.getAllHoaDonCho()) {
            tblModel.addRow(x.toDataRow());
        }
    }

    public void fillTableHoaDon(int id) {
        DefaultTableModel tblModel = (DefaultTableModel) tblHoaDon.getModel();
        tblModel.setRowCount(0);

        for (HoaDonChiTietModel x : repo.getAllHoaDon(id)) {
            tblModel.addRow(x.toDataRow());
        }
    }

    public void showData(int index) {

        HoaDonModel hd = qLy.getHoaDon(tblHoaDonCho.getSelectedRow());
        int indexHdC = tblHoaDonCho.getSelectedRow();
      

        jTabbedPane5.setTitleAt(0, hd.getMaHoaDon());
        jblMaHoaDon.setText(hd.getMaHoaDon());
        fillTableHoaDon(hd.getId());
        tongTien(repo.getTongTien(hd.getId()));

        String tenKH = qLy.getAllHoaDonCho().get(indexHdC).getTenKhachHang();

        txtTenKhachHang.setText(tenKH);
        txtSoDienThoai.setText(qLy.getAllHoaDonCho().get(indexHdC).getSoDienThoai());

        if (tenKH == null) {
            txtTenKhachHang.setText("Khách Vãng Lai");
            txtSoDienThoai.setText(null);
        }

//        VoucherModel voucherModel = voucherRepo.getIdVoucher(qLy.getAllHoaDonCho().get(indexHdC).getIdVoucher());
//        if (voucherModel.getMaVoucher() != null) {
//
//            txtMaVoucher.setText(voucherModel.getMaVoucher());
//            if (voucherModel.getLoaiVoucher().contains("%")) {
//
//                txtGiamGia.setText(voucherModel.getGiaTri() + " %");
//            } else {
//                txtGiamGia.setText(voucherModel.getGiaTri() + " VNĐ");
//            }
//        } else {
//            txtMaVoucher.setText(null);
//            txtGiamGia.setText(null);
//        }
//        txtTienMat.setText(null);
//        txtChuyenKhoan.setText(null);
//        txtTienDu.setText(null);
//
//        this.fillPanelSanPham();
    }
    
    
    public void tongTien(int tongTien) {
        DecimalFormat format = new DecimalFormat("#,###");
        String numberFormat = format.format(tongTien);
        txtTongTien.setText(numberFormat);
        txtThanhTien.setText(numberFormat);
    }

    public void inputThanhTien(boolean tb) {
        if (txtTongTien.getText().isEmpty()) {
            JOptionPane.showMessageDialog(this, "Chọn hóa đơn cần áp Voucher");
        } else if (txtMaVoucher.getText().isEmpty()) {
            JOptionPane.showMessageDialog(this, "Chưa chọn mã Voucher nào!");
        } else {
            String tongTien = txtTongTien.getText().replace(".", "");
            int spaceIndex = txtGiamGia.getText().indexOf(" ");

            long tong = Long.parseLong(tongTien);
            int giam = Integer.parseInt(txtGiamGia.getText().substring(0, spaceIndex));

            long thanhTien;
            if (txtGiamGia.getText().contains("%")) {

                thanhTien = tong - ((tong / 100) * giam);
            } else {

                thanhTien = Integer.parseInt(tongTien) - Integer.parseInt(txtGiamGia.getText().substring(0, spaceIndex));
            }
            DecimalFormat format = new DecimalFormat("#,###");
            String numberFormat = format.format(thanhTien);

            txtThanhTien.setText(numberFormat);
            txtTienMat.setText(null);
            txtChuyenKhoan.setText(null);
            if (tb) {
                JOptionPane.showMessageDialog(this, "Đã áp dụng Voucher thành công");
            }
        }
    }

    public void inputThanhToan(JTextField txtTtLoai1, JTextField txtTtLoai2) {

        String thanhTien = txtThanhTien.getText().replace(".", "");

        long tienDu = 0;

        if (txtTtLoai2.getText().length() > 13) {
            JOptionPane.showMessageDialog(this, "Vui lòng nhập dưới 999 tỷ");
        } else {
            if (txtTtLoai2.getText().isEmpty()) {

            } else if (txtTtLoai1.getText().isEmpty()) {

                tienDu = Long.parseLong(txtTtLoai2.getText()) - Integer.parseInt(thanhTien);
            } else {

                tienDu = Long.parseLong(txtTtLoai1.getText()) + Integer.parseInt(txtTtLoai2.getText()) - Integer.parseInt(thanhTien);
            }

            txtTienDu.setText(String.valueOf(tienDu));
        }
    }

//    public void modelComboBox() {
//        DefaultComboBoxModel comboBox = (DefaultComboBoxModel) cbbLoaiSanPham.getModel();
//        comboBox.removeAllElements();
//
//        comboBox.addElement("Tất Cả");
//
//        for (String x : qLy.modelComboBox()) {
//            comboBox.addElement(x);
//        }
//    }
    public boolean checkTable() {
        if (tblHoaDon.getRowCount() == 0) {

            JOptionPane.showMessageDialog(this, "Hóa đơn trống");
            return false;
        }
        return true;
    }

    public void thanhToan() {

        if (jblMaHoaDon.getText().equals("#####")) {
            JOptionPane.showMessageDialog(this, "Chọn hóa đơn cần thanh toán");

        } else if (checkTable()) {
            long tienDu;
            long tienMat;
            long tienCk;

            try {
                tienDu = Long.parseLong(txtTienDu.getText());
            } catch (NumberFormatException e) {
                tienDu = -1;
            }

            try {
                tienMat = Long.parseLong(txtTienMat.getText());
            } catch (NumberFormatException e) {
                tienMat = -1;
            }

            try {
                tienCk = Long.parseLong(txtChuyenKhoan.getText());
            } catch (NumberFormatException e) {
                tienCk = -1;
            }
            if (tienMat <= 0 && tienCk <= 0) {
                JOptionPane.showMessageDialog(this, "Khách hàng chưa thanh toán hóa đơn");

            } else if (tienDu < 0) {
                JOptionPane.showMessageDialog(this, "Khách hàng thanh toán còn thiếu");
            } else if (tienDu > 1000000) {
                JOptionPane.showMessageDialog(this, "Trả lại tiền thừa cho khách hàng");
            } else {

                if (true) {
                    String thanhTien = txtThanhTien.getText().replace(".", "");
                    long tongTien = Long.parseLong(thanhTien);
                    String loai = cbbThanhToan.getSelectedItem().toString();

                    if (cbbThanhToan.getSelectedIndex() == 2) {

                        if (tienMat <= 0 || txtTienMat.getText().trim().isEmpty()) {

                            loai = "Chuyển Khoản";
                        }
                        if (tienCk <= 0 || txtChuyenKhoan.getText().trim().isEmpty()) {

                            loai = "Tiền Mặt";
                        }
                    }
                    this.qLy.updateThanhToanHoaDon(loai, tongTien,
                            qLy.getHoaDon(tblHoaDonCho.getSelectedRow()).getId());
                    JOptionPane.showMessageDialog(this, "Thanh toán thành công");
                    this.loadForm();
                }
            }
        }
    }
    
    public void loadForm () {
        txtTenKhachHang.setText(null);
        txtSoDienThoai.setText(null);
        txtTongTien.setText(null);
        txtThanhTien.setText(null);
        txtTienMat.setText(null);
        txtChuyenKhoan.setText(null);
        txtTienDu.setText(null);
        fillTableHoaDonCho();
        fillTableHoaDon();
        DefaultTableModel tblModel = (DefaultTableModel) tblHoaDon.getModel();
        tblModel.setRowCount(0);
    }

    public void huyKhachHang() {

        int indexHdC = tblHoaDonCho.getSelectedRow();

        if (indexHdC != -1) {
            if (txtTenKhachHang.getText().equals("Khách Vãng Lai")) {
                JOptionPane.showMessageDialog(this, "Hóa đơn này đang là của khách vãng lai");
            } else {
                this.qLy.suaKhachHangHoaDon(qLy.getHoaDon(tblHoaDonCho.getSelectedRow()).getId());
                fillTableHoaDonCho();
                tblHoaDonCho.setRowSelectionInterval(indexHdC, indexHdC);
                JOptionPane.showMessageDialog(this, "Đã đổi hóa đơn " + jblMaHoaDon.getText() + " thành của khách vãng lai");
                txtTenKhachHang.setText("Khách Vãng Lai");
                txtSoDienThoai.setText(null);
            }

        } else {
            JOptionPane.showMessageDialog(this, "Chọn hóa đơn của khách hàng cần hủy");
        }
    }
    public void updateTrangThai() {
        int result = JOptionPane.showConfirmDialog(this,
                "Bạn có muốn hủy chọn sản phẩm này?",
                "Xác nhận",
                JOptionPane.YES_NO_OPTION);

        if (result == JOptionPane.YES_OPTION) {
            int rowIndex = tblHoaDon.getSelectedRow();
            int indexHdC = tblHoaDonCho.getSelectedRow();

            // Cập nhật lại số lượng sản phẩm trong kho
            int soLuong = Integer.parseInt(tblHoaDon.getValueAt(rowIndex, 3).toString());
            int idSpct = qLy.getIdMaSpct(tblHoaDon.getValueAt(rowIndex, 0).toString()).getId();
            qLy.getSoLuongSpct(soLuong, idSpct);

            // Cập nhật trạng thái hóa đơn chi tiết
            int idHdct = qLy.getAllHoaDon(qLy.getHoaDon(indexHdC)
                    .getId()).get(rowIndex).getId();
            qLy.updateTrangThaiHdct(idHdct);

            // Cập nhật lại UI
            fillTableSp();
            HoaDonModel hd = qLy.getHoaDon(tblHoaDonCho.getSelectedRow());
            fillTableHoaDon(hd.getId());
            tongTien(repo.getTongTien(hd.getId()));
        }
    }


    public void tienMat() {

        Pattern pattern = Pattern.compile("\\d+");
        Matcher matcher = pattern.matcher(txtTienMat.getText());

        if (matcher.matches()) {

            this.inputThanhToan(txtChuyenKhoan, txtTienMat);
        }
    }

    public void chuyenKhoan() {

        Pattern pattern = Pattern.compile("\\d+");
        Matcher matcher = pattern.matcher(txtChuyenKhoan.getText());

        if (matcher.matches()) {

            this.inputThanhToan(txtTienMat, txtChuyenKhoan);
        }
    }

    public void cleanTextVoucher() {
        txtMaVoucher.setText(null);
        txtGiamGia.setText(null);
    }

    public void setMouse() {
        txtSearch.requestFocus();
    }

    public void cleanTextKhachHang() {
        txtTenKhachHang.setText(null);
        txtSoDienThoai.setText(null);
    }

    public void fillTableSp() {
        defaultTableModel = (DefaultTableModel) tblsanpham.getModel();
        defaultTableModel.setRowCount(0);
        tblsanpham.setRowHeight(85);
        for (SanPhamChiTiet sp : repo.getDataTableSp(txtSearch.getText())) {
            defaultTableModel.addRow(sp.getData());
        }
        tblsanpham.getColumnModel().getColumn(0).setCellRenderer(new ImageRenderer());
    }

    public void updateCbbThanhToan() {

        if (tblHoaDonCho.getSelectedRow() != -1) {

            switch (cbbThanhToan.getSelectedIndex()) {
                case 0 -> {
                    txtChuyenKhoan.setEnabled(false);
                    txtTienMat.setEnabled(true);
                    txtChuyenKhoan.setText(null);
                    txtTienDu.setText(null);
                }
                case 1 -> {
                    txtChuyenKhoan.setEnabled(true);
                    txtTienMat.setEnabled(false);
                    txtTienMat.setText(null);
                    txtTienDu.setText(null);
                }
                default -> {
                    txtChuyenKhoan.setEnabled(true);
                    txtTienMat.setEnabled(true);
                }
            }
        }
    }

    public boolean checkVoucher() {

        if (txtThanhTien.getText().equals(txtTongTien.getText())) {

            this.huyVoucher();
            return true;
        }
        return true;
    }

    public void huyVoucher() {
        if (tblHoaDonCho.getSelectedRow() != -1) {

            if (!txtMaVoucher.getText().isEmpty()) {

                this.qLy.suaVoucherHoaDon(qLy.getHoaDon(tblHoaDonCho.getSelectedRow()).getId());
                txtMaVoucher.setText(null);
                txtGiamGia.setText(null);
                txtThanhTien.setText(txtTongTien.getText());
                JOptionPane.showMessageDialog(this, "Hủy Voucher thành công");
            } else {
                JOptionPane.showMessageDialog(this, "Hóa đơn chưa được áp Voucher");
            }

        } else {
            JOptionPane.showMessageDialog(this, "Chọn hóa đơn muốn hủy Voucher");
        }
    }

    public void createHoaDon() {
        DefaultTableModel tblModel = (DefaultTableModel) tblHoaDonCho.getModel();
        tblModel.setRowCount(0);

//        jTabbedPane1.setTitleAt(0, qLy.createMaHoaDon());
        jblMaHoaDon.setText(qLy.createMaHoaDon());
        txtTenKhachHang.setText("Khách Vãng Lai");
        DefaultTableModel tblModelHoaDon = (DefaultTableModel) tblHoaDon.getModel();
        tblModelHoaDon.setRowCount(0);
        qLy.themHoaDonMoi(idNhanVien);
        fillTableHoaDonCho();
        cleanTextKhachHang();
        cleanTextVoucher();
        tblHoaDonCho.setRowSelectionInterval(tblHoaDonCho.getRowCount() - 1, tblHoaDonCho.getRowCount() - 1);

        JOptionPane.showMessageDialog(this, "Tạo hóa đơn thành công");
    }

    //HÓA ĐƠN
    private void fillTableHoaDon() {
        DefaultTableModel dblModel = (DefaultTableModel) tblLichSuHoaDon.getModel();
        dblModel.setRowCount(0);
        String nbd;
        String nkt;
        if (cbbTrangThai.getSelectedItem() != null) {
            if (txtLocNgayBD.getDate() == null && txtLocNgayKT.getDate() == null) {
                nbd = "abc";
                nkt = "abc";
            } else {
                SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");
                nbd = format.format(txtLocNgayBD.getDate());
                nkt = format.format(txtLocNgayKT.getDate());
            }
            for (HoaDonModel x : qlyhd.getAllHoaDon(txtSearchMaHoaDon.getText(), cbbTrangThai.getSelectedIndex(), nbd, nkt)) {

                dblModel.addRow(x.toDataRow());
            }

        }
    }
    
    public HoaDonModel getLichSuHoaDon(int index) {
        String nbd;
        String nkt;
        if (txtLocNgayBD.getDate() == null && txtLocNgayKT.getDate() == null) {
            nbd = "abc";
            nkt = "abc";
        } else {
            SimpleDateFormat format = new SimpleDateFormat("yyyy-MM-dd");
            nbd = format.format(txtLocNgayBD.getDate());
            nkt = format.format(txtLocNgayKT.getDate());
        }
        return qlyhd.getAllHoaDon(txtSearchMaHoaDon.getText(), cbbTrangThai.getSelectedIndex(), nbd, nkt).get(index);
    }

    private void fillDataHoaDon(HoaDonModel hdct) {
        lblMaHoaDon.setText(hdct.getMaHoaDon());
        lblTenKhachHang.setText(hdct.getTenKhachHang() == null || hdct.getTenKhachHang().trim().isEmpty() ? "Khách vãng lai" : hdct.getTenKhachHang());
        lblSoDienThoai.setText(hdct.getSoDienThoai());
        lblThoiGianTao.setText(hdct.getThoiGianTao());
        lblLoaiThanhToan.setText(hdct.getLoaiThanhToan());
        lblTrangThai.setText(String.valueOf(hdct.getTrangThai() == 0 ? "Đã Thanh Toán" : "Chưa Thanh Toán"));
        lbltenVoucher.setText(hdct.getTenVoucher());
        lblTongTienHD.setText(String.valueOf(hdct.getTongTien()));
        lblThanhTienHD.setText(String.valueOf(hdct.getTongTien()));
    }

    public void lamMoi() {
        this.fillTableHoaDon();
        lblMaHoaDon.setText("X");
        lblTenKhachHang.setText("X");
        lblSoDienThoai.setText("X");
        lblThoiGianTao.setText("X");
        lblLoaiThanhToan.setText("X");
        lblTrangThai.setText("X");
        lbltenVoucher.setText("X");
        clearTable();
    }

//    public void selectedArrFirst() {
//        if (!qLy.getAllHoaDon(txtSearchMaHoaDon.getText(), cbbTrangThai.getSelectedIndex()).isEmpty(),nbd.nkt) {
//            this.tblLichSuHoaDon.setRowSelectionInterval(0, 0);
//            this.showData(0);
//        }
//    }
    public void clearTable() {
        DefaultTableModel tblModel = (DefaultTableModel) tblSanPhamHD.getModel();
        tblModel.setRowCount(0);
    }

//    public void fillTableHoaDonChiTiet(int index) {
//        DefaultTableModel dblModel = (DefaultTableModel) tblSanPhamHD.getModel();
//        dblModel.setRowCount(0);
//
//        for (HoaDonChiTietModel x : qLy.getAllHdct(qLy.getAllHoaDon(txtSearchMaHoaDon.getText(), cbbTrangThai.getSelectedIndex()).get(index).getId())) {
//            dblModel.addRow(x.toDataRow());
//        }
//    }
    private void fillTableHoaDonCT (int idHoaDon) {
        DefaultTableModel dblModel = (DefaultTableModel) tblSanPhamHD.getModel();
        dblModel.setRowCount(0);
        for (HoaDonChiTietModel x : qLyChiTiet.getHdct (idHoaDon)) {
            dblModel.addRow(x.toDataRow());
        }
    }
//    public void removeTitleBar() {
//        ((BasicInternalFrameUI) this.getUI()).setNorthPane(null);
//    }

    public int getIdHD(int index) {
        return qlyhd.getIdHD().get(index).getId();
    }

    public int getIdHDCT(int index) {
        return qLyChiTiet.getIdHDCT().get(index).getId();
    }
//    public void setMouse() {
//        txtLocNgayBD.requestFocus();
//    }


private void chonSanPham() {
    int selectedRow = tblsanpham.getSelectedRow();
    int hoaDonSelected = tblHoaDonCho.getSelectedRow();

    // Kiểm tra nếu chưa chọn hóa đơn hoặc chưa có hóa đơn
    if (hoaDonSelected == -1) {
        JOptionPane.showMessageDialog(this, "Vui lòng tạo hóa đơn trước khi chọn sản phẩm!");
        return; // Dừng phương thức nếu chưa chọn hóa đơn
    }

    // Kiểm tra nếu chưa chọn sản phẩm
    if (selectedRow == -1) {
        JOptionPane.showMessageDialog(this, "Vui lòng chọn sản phẩm trước!");
        return; // Dừng phương thức nếu chưa chọn sản phẩm
    }

    // Tiếp tục nếu đã chọn hóa đơn và sản phẩm
    SanPhamChiTiet spct = getSPCT(selectedRow);
    HoaDonModel hd = getHoaDon(hoaDonSelected);

    String soLuongStr = JOptionPane.showInputDialog(this, "Nhập số lượng:");
    if (soLuongStr != null && !soLuongStr.trim().isEmpty()) {
        try {
            int soLuong = Integer.parseInt(soLuongStr);

            if (soLuong > 0) {
                int soLuongHienCo = spct.getSoLuong(); // Lấy số lượng hiện có từ sản phẩm

                if (soLuong > soLuongHienCo) {
                    JOptionPane.showMessageDialog(this, "Số lượng không đủ! Chỉ còn " + soLuongHienCo + " sản phẩm.");
                    return; // Dừng phương thức nếu số lượng nhập vào lớn hơn số lượng hiện có
                }

                if (repo.kiemTraSpct(hd.getId(), spct.getId())) {
                    repo.themSpct(soLuong, soLuong * spct.getGiaSanPham().doubleValue(), hd.getId(), spct.getId());
                } else {
                    repo.updateSoLuongHdct(soLuong, hd.getId(), spct.getId());
                }

                repo.updateSoLuongSpct(soLuong, spct.getId());
                tongTien(repo.getTongTien(hd.getId()));
                fillTableHoaDon(hd.getId());
                fillTableSp();
            } else {
                JOptionPane.showMessageDialog(this, "Số lượng phải lớn hơn 0!");
            }
        } catch (NumberFormatException ex) {
            JOptionPane.showMessageDialog(this, "Vui lòng nhập số hợp lệ!");
        }
    }
}


public void frameVoucher(String title) {
    if (jblMaHoaDon.getText().equals("#####")) {
        int result = JOptionPane.showConfirmDialog(
            this, 
            "Tạo hóa đơn mới cho voucher bạn muốn chọn?", 
            "Xác nhận", 
            JOptionPane.YES_NO_OPTION
        );

        if (result == JOptionPane.YES_OPTION) {
            String ma = qLy.createMaHoaDon();
            qLy.themHoaDonMoi(idNhanVien);
            qLy.fillTableHoaDonCho(tblHoaDonCho);
            jTabbedPane5.setTitleAt(0, ma);
            jblMaHoaDon.setText(ma);
            tblHoaDonCho.setRowSelectionInterval(tblHoaDonCho.getRowCount() - 1, tblHoaDonCho.getRowCount() - 1);

            createFromVoucher();
        }
    } else {
        createFromVoucher();
    }
}
public void createFromVoucher() {

        int loadTable = 1;
        String title = "Thông tin khách hàng";
        JFrame frame = new JFrame(title);
        frame.setSize(617, 600);
        frame.setLocationRelativeTo(null);

        Panel_Voucher voucher = new Panel_Voucher(frame, txtMaVoucher, txtGiamGia,
                qLy.getAllHoaDonCho().get(tblHoaDonCho.getSelectedRow()).getId(), loadTable);

        frame.add(voucher);
        frame.setVisible(true);
    }
public void frameKhachHang(String title) {
    // Kiểm tra nếu mã hóa đơn là "#####", nghĩa là chưa có hóa đơn
    if (jblMaHoaDon.getText().equals("#####")) {
        int result = JOptionPane.showConfirmDialog(this, "Tạo hóa đơn mới cho khách hàng?", "Xác nhận", JOptionPane.YES_NO_OPTION);

        if (result == JOptionPane.YES_OPTION) {
            String ma = qLy.createMaHoaDon(); // Tạo mã hóa đơn mới
            qLy.themHoaDonMoi(idNhanVien);  // Thêm hóa đơn mới vào hệ thống
            qLy.fillTableHoaDonCho(tblHoaDonCho); // Làm mới bảng hóa đơn
            jTabbedPane5.setTitleAt(0, ma); // Cập nhật tiêu đề tab
            jblMaHoaDon.setText(ma);  // Đặt mã hóa đơn vào label
            tblHoaDonCho.setRowSelectionInterval(tblHoaDonCho.getRowCount() - 1, tblHoaDonCho.getRowCount() - 1); // Chọn dòng mới

            // Gọi phương thức tạo cửa sổ thông tin khách hàng
            createFromKhachHang();
        }
    } else {
        // Nếu đã có hóa đơn, chỉ cần hiển thị thông tin khách hàng
        createFromKhachHang();
    }
}

public void createFromKhachHang() {
    // Lấy chỉ số dòng đã chọn từ bảng
    int index = tblHoaDonCho.getSelectedRow();

    // Kiểm tra nếu không có dòng nào được chọn
    if (index == -1) {
        JOptionPane.showMessageDialog(this, "Vui lòng chọn hóa đơn.", "Lỗi", JOptionPane.ERROR_MESSAGE);
        return;
    }

    // Lấy hóa đơn đã chọn từ bảng
    HoaDonModel selectedHoaDon = qLy.getAllHoaDonCho().get(index);
    
    // Tạo cửa sổ mới để hiển thị thông tin khách hàng
    String title = "Thông tin khách hàng";
    JFrame frame = new JFrame(title);
    frame.setSize(617, 540);
    frame.setLocationRelativeTo(null);

    // Tạo panel KhachHangPanel và truyền các tham số cần thiết
    KhachHangPanel kh = new KhachHangPanel(
        frame,
        txtTenKhachHang, 
        txtSoDienThoai,
        index, // Chỉ số dòng đã chọn
        selectedHoaDon.getId(), // ID hóa đơn đã chọn
        tblHoaDonCho // Truyền bảng hóa đơn cho panel
    );

    // Thêm panel vào frame và hiển thị
    frame.add(kh);
    frame.setVisible(true);
}


    public SanPhamChiTiet getSPCT(int index) {
        return repo.getDataTableSp(txtSearch.getText()).get(index);
    }
    
    public HoaDonChiTietModel getHdct (int index, int idHoaDon) {
        return repo.getIdSpct(idHoaDon).get(index);
    }
    
    public HoaDonModel getHoaDon (int index) {
        return repo.getAllHoaDonCho().get(index);
    }
    
    class ImageRenderer extends JLabel implements TableCellRenderer {
        
        public ImageRenderer() {
            setHorizontalAlignment(JLabel.CENTER);
            setVerticalAlignment(JLabel.CENTER);
        }
        
        @Override
        public Component getTableCellRendererComponent(JTable table, Object value, boolean isSelected, boolean hasFocus, int row, int column) {
            if (value instanceof ImageIcon) {
                setIcon((ImageIcon) value);
            } else {
                setIcon(null);
            }
            return this;
        }
    }
    
    public void showPopup(JTable table) {
        table.addMouseListener(new MouseAdapter() {
            @Override
            public void mousePressed(MouseEvent e) {
                showPopup(e);
            }

            @Override
            public void mouseReleased(MouseEvent e) {
                showPopup(e);
            }

            private void showPopup(MouseEvent e) {
                if (e.isPopupTrigger()) {

                    int row = table.rowAtPoint(e.getPoint());
                    int column = table.columnAtPoint(e.getPoint());

                    if (row >= 0 && column >= 0) {

                        table.setRowSelectionInterval(row, row);
                        table.setColumnSelectionInterval(column, column);

                        jPopupMenu1.show(e.getComponent(), e.getX(), e.getY());
                    }
                }
            }
        });
    }
    public void updateSoLuong() {

        int i = JOptionPane.showConfirmDialog(this, "Bạn có muốn sửa số lượng sản phẩm này ?", "TaiCho", JOptionPane.YES_OPTION);
        
        int indexHdC = tblHoaDonCho.getSelectedRow();
        int indexHd = tblHoaDon.getSelectedRow();
        
        HoaDonModel hd = getHoaDon(indexHdC);
        int IdHdct = getHdct(indexHd, hd.getId()).getId();

        if (i == JOptionPane.YES_OPTION) {
            
            String soLuongStr = JOptionPane.showInputDialog(this, "Nhập số lượng:");
            if (soLuongStr != null && !soLuongStr.trim().isEmpty()) {
                try {
                    int soLuong = Integer.parseInt(soLuongStr);

                    if (soLuong > 0) {
                        int soLuongCu = Integer.parseInt(tblHoaDon.getValueAt(indexHd, 3).toString());

                        if (soLuong <= qLy.getIdMaSpct(tblHoaDon.getValueAt(indexHd, 0).toString()).getSoLuong() + soLuongCu) {

                            if (soLuong != Integer.parseInt(tblHoaDon.getValueAt(indexHd, 3).toString())) {

                                qLy.updateSoLuong(soLuongCu, soLuong, qLy.getIdMaSpct(tblHoaDon.getValueAt(indexHd, 0).toString()).getId());
                            }
                            
                            qLy.updateSoLuongHdct(soLuong, IdHdct);
                        } else {

                            JOptionPane.showMessageDialog(this, "Số lượng sản phẩm không đủ");
                        }

                        tongTien(repo.getTongTien(hd.getId()));
                        fillTableHoaDon(hd.getId());
                        fillTableSp();
                    } else {
                        JOptionPane.showMessageDialog(this, "Số lượng phải lớn hơn 0!");
                    }
                } catch (NumberFormatException ex) {
                    JOptionPane.showMessageDialog(this, "Vui lòng nhập số hợp lệ!");
                }
            }
        }
    }

}
